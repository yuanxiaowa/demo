"use strict";function ChinaChess(s){this.count=90,this.draw=s.draw,this.init=s.init,this.success=s.success}ChinaChess.prototype={constructor:ChinaChess,genBoards:function(){var s,t=this.boards=Array(),e=this.chesses=Array(this.count),i=["將","士","象","馬","車"],r=["帥","仕","相","馬","車"],n=4;for(s=0;s<i.length;s++)s?(t.push({type:s,name:i[s],pos:n+s,owner:0}),t.push({type:s,name:i[s],pos:n-s,owner:0}),t.push({type:s,name:r[s],pos:this.count-1-n-s,owner:1}),t.push({type:s,name:r[s],pos:this.count-1-n+s,owner:1})):(t.push({type:s,name:i[s],pos:n,owner:0}),t.push({type:s,name:r[s],pos:this.count-1-n,owner:1}));for(n+=18,t.push({type:5,name:"炮",pos:n-3,owner:0}),t.push({type:5,name:"炮",pos:n+3,owner:0}),t.push({type:5,name:"炮",pos:this.count-1-n+3,owner:1}),t.push({type:5,name:"炮",pos:this.count-1-n-3,owner:1}),n+=9,s=0;3>s;s++)s?(t.push({type:6,name:"卒",pos:n+2*s,owner:0}),t.push({type:6,name:"卒",pos:n-2*s,owner:0}),t.push({type:6,name:"兵",pos:this.count-1-n-2*s,owner:1}),t.push({type:6,name:"兵",pos:this.count-1-n+2*s,owner:1})):(t.push({type:6,name:"卒",pos:n,owner:0}),t.push({type:6,name:"兵",pos:this.count-1-n,owner:1}));for(s=0;s<t.length;s++)e[t[s].pos]=s},start:function(){this.turn=1,this.isStart=!0,this.current=void 0,this.last=void 0,this.genBoards(),this.init(),this.draw()},stop:function(){this.isStart=!1},restart:function(){this.stop(),this.start()},click:function(s){var t=this.boards[s];return this.turn===t.owner?(this.current!==s?this.current=s:this.current=void 0,this.draw(),!0):this.move(t.pos)},move:function(s){if(void 0!==this.current){var t=this.boards[this.current];if(this.turn===t.owner&&this.isValid(s)){var e=this.chesses[s];return this.chesses[s]=this.current,this.chesses[t.pos]=void 0,t.pos=s,0===this.turn?this.turn=1:this.turn=0,void 0!==e&&(this.boards[e].disabled=!0,0===this.boards[e].type&&(this.isStart=!1,this.success())),this.draw(),!0}}},getPos:function(s,t){var e=9*s+t;return this.chesses[e]},between:function(s,t){var e=parseInt(s/9),i=s%9,r=parseInt(t/9),n=t%9,o=0,h=1;if(e===r)for(i>n&&(h=-1);(i+=h)!==n;)void 0!==this.getPos(e,i)&&(o+=1);else if(i===n)for(e>r&&(h=-1);(e+=h)!==r;)void 0!==this.getPos(e,i)&&(o+=1);else{var p=Math.pow(e-r,2)+Math.pow(i-n,2);if(8===p)void 0!==this.getPos((e+r)/2,(i+n)/2)&&(o+=1);else if(5===p){var u=e-r,a=i-n;2===u||-2===u?(2===u&&(h=-1),void 0!==this.getPos(e+h,i)&&(o+=1)):2!==a&&-2!==a||(2===a&&(h=-1),void 0!==this.getPos(e,i+h)&&(o+=1))}}return o},isValid:function(s){var t,e,i=this.boards[this.current],r=i.pos,n=i.owner,o=s;1===n&&(o=this.count-1-o,r=this.count-1-r);var h=parseInt(r/9),p=parseInt(r%9),u=parseInt(o/9),a=parseInt(o%9);t=u-h,e=a-p;var c=t*t+e*e;if(0===i.type){if(2>=u&&a>=3&&5>=a&&1===c)return!0}else if(1===i.type){if(2>=u&&a>=3&&5>=a&&2===c)return!0}else if(2===i.type){if(4>=u&&a%2===0&&8===c&&0===this.between(i.pos,s))return!0}else if(3===i.type){if(5===c&&0===this.between(i.pos,s))return!0}else if(4===i.type){if((0===t||0===e)&&0===this.between(i.pos,s))return!0}else if(5===i.type){if(0===t||0===e){var f=this.between(i.pos,s),w=this.chesses[s];if(0===f){if(void 0===w)return!0}else if(1===f&&void 0!==w)return!0}}else if(6===i.type&&1===c){if(1===t)return!0;if(0===t&&h>4)return!0}}};